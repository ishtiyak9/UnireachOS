generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
  binaryTargets   = ["native"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --- CORE IDENTITY ---
model User {
  id       String @id @default(uuid())
  email    String @unique
  password String

  // Dynamic Role System (Cerebro Core)
  roleId String
  role   SystemRole @relation(fields: [roleId], references: [id])

  status    AccountStatus @default(PENDING_VERIFICATION)
  lastLogin DateTime?

  // Profiles (Exclusive relation based on Role Permissions)
  staffProfile     StaffProfile?
  agentProfile     AgentProfile?
  applicantProfile ApplicantProfile?

  // Instance Permissions (Neural Add-ons)
  groups UserPermissionGroup[]

  // Infrastructure
  loginLogs          LoginLog[]
  auditLogs          AuditLog[]          @relation("PerformedBy")
  maintenanceWindows MaintenanceWindow[] @relation("MaintenanceCreator")

  notifications          Notification[]
  notificationPreference NotificationPreference?

  programLevelsCreated ProgramLevel[] @relation("ProgramLevelCreator")
  programLevelsUpdated ProgramLevel[] @relation("ProgramLevelUpdater")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Ownership Mapping (Lineage)
  createdById String?
  createdBy   User?   @relation("UserLineage", fields: [createdById], references: [id])
  createdUsers User[] @relation("UserLineage")

  @@index([roleId])
  @@index([status])
  @@index([createdById])
}

// --- AUTHORIZATION ENGINE (RBAC v2: Neural Clusters) ---
model SystemRole {
  id          String       @id @default(uuid())
  name        String       @unique // e.g. "SUPERADMIN", "REGIONAL_AGENT", "HEAD_OFFICIAL"
  code        String       @unique // e.g. "super_admin", "agent_standard"
  category    RoleCategory @default(APPLICANT)
  description String?
  isSystem    Boolean      @default(false)

  users       User[]
  permissions RolePermission[]
  groups      RolePermissionGroup[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model PermissionGroup {
  id          String  @id @default(uuid())
  name        String  @unique // e.g. "Admission Operations Pack"
  code        String  @unique // e.g. "pkg_admission_ops"
  category    String  @default("SYSTEM") // SYSTEM, AGENT, APPLICANT
  description String?

  permissions GroupPermission[]
  roles       RolePermissionGroup[]
  users       UserPermissionGroup[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Permission {
  id          String  @id @default(uuid())
  code        String  @unique // e.g. "application:approve", "user:create"
  name        String
  group       String  @default("GENERAL") // UI Grouping (e.g. "ACCOUNTS")
  description String?

  roles            RolePermission[]
  permissionGroups GroupPermission[]

  createdAt DateTime @default(now())
}

model RolePermission {
  roleId       String
  permissionId String
  role         SystemRole @relation(fields: [roleId], references: [id], onDelete: Cascade)
  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)

  @@id([roleId, permissionId])
}

model GroupPermission {
  groupId      String
  permissionId String
  group        PermissionGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)
  permission   Permission      @relation(fields: [permissionId], references: [id], onDelete: Cascade)

  @@id([groupId, permissionId])
}

model RolePermissionGroup {
  roleId  String
  groupId String
  role    SystemRole      @relation(fields: [roleId], references: [id], onDelete: Cascade)
  group   PermissionGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@id([roleId, groupId])
}

model UserPermissionGroup {
  userId  String
  groupId String
  user    User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  group   PermissionGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@id([userId, groupId])
}

// --- SYSTEM/OFFICIAL PROFILES ---
model StaffProfile {
  id         String  @id @default(uuid())
  userId     String  @unique
  user       User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  firstName  String
  lastName   String
  department String?
  position   String?

  assignedApplicants ApplicantProfile[] @relation("StaffAssignments")
  applications       Application[]

  // Core Specialties (e.g. ["Germany", "Australia"])
  specialties String[]

  // Intelligence Layer Config
  lastLeadAssignedAt  DateTime?
  isAutoAssignEnabled Boolean   @default(true)

  leads                  Lead[]                 @relation("CounselorLeads")
  leadEvents            LeadEvent[]            @relation("EventPerformer")

  teamId String?
  team   Team?   @relation(fields: [teamId], references: [id])

  unlockRequests         ProfileUnlockRequest[]
  documentUnlockRequests DocumentUnlockRequest[]
}

// --- SYSTEM CONFIGURATION (Control Panel) ---
// Singleton row (id="global") stores strict operational flags
model SystemConfig {
  id String @id @default("global")

  // --- 1. Global Switches (Operational Gates) ---
  allowPublicRegister Boolean @default(true) // Students
  allowAgentRegister  Boolean @default(true) // Startups/Partners

  allowStudentLogin Boolean @default(true)
  allowAgentLogin   Boolean @default(true)

  systemBannerMessage String? // "Scheduled maintenance at 2 AM"
  systemBannerType    String? // INFO, WARNING, ERROR

  // --- 4. Feature Flags ---
  metadata Json?

  updatedAt DateTime @updatedAt
}

// --- MAINTENANCE ORCHESTRATOR ---
model MaintenanceWindow {
  id          String  @id @default(uuid())
  reason      String // e.g. "Database Migration" or "Emergency Patch"
  description String? // Public facing message

  startTime DateTime // When it starts
  endTime   DateTime? // If null, indefinite/manual stop required

  status MaintenanceStatus @default(SCHEDULED)

  // Auditor
  createdById String
  createdBy   User   @relation("MaintenanceCreator", fields: [createdById], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum MaintenanceStatus {
  SCHEDULED // Future planned
  ACTIVE // Currently enforcing
  COMPLETED // Finished/History
  CANCELLED // Aborted
}

// --- ACCESS CONTROL (Firewall) ---
model SystemAccessControl {
  id   String            @id @default(uuid())
  type AccessControlType @default(ALLOW) // ALLOW (Whitelist) or BLOCK (Blacklist)

  ipAddress String  @unique // Individual IP or CIDR block
  reason    String? // "HQ VPN" or "DDoS Attack Source"

  addedBy   String? // User ID of Admin
  expiresAt DateTime? // For temporary bans or temporary access

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum AccessControlType {
  ALLOW
  BLOCK
}

// --- AGENT PROFILES ---
model AgentProfile {
  id     String @id @default(uuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Personal Details
  firstName    String?
  lastName     String?
  address      String?
  country      String?
  primaryEmail String?
  primaryPhone String?

  // Company Details
  agencyName     String  // Used as Company Name
  companyAddress String?
  licenseNo      String? @unique // Used as Registration Number

  // Operational Settings (Commission Clusters)
  showCommissionInSearch      Boolean @default(true)
  sendCommissionNotifications Boolean @default(true)
  showCommissionPaymentTab    Boolean @default(true)

  // Bank Account Details (Financial Nodes)
  beneficiaryName   String?
  bankAccountNumber String?
  bankName          String?
  bankBranch        String?
  bankLocation      String? // Physical Address
  bankCountry       String?
  bankState         String?
  bankCity          String?
  bankSwiftCode     String?
  bankIban          String?

  phone      String? // Legacy / General Phone
  commission Float   @default(0.0)

  // Relations
  applicants ApplicantProfile[]
  enquiries  Enquiry[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// --- APPLICANT PROFILES (Students/Expatriates) ---
model ApplicantProfile {
  id          String        @id @default(uuid())
  userId      String        @unique
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  type        ApplicantType @default(STUDENT)
  isLocked    Boolean       @default(false)
  submittedAt DateTime?

  // External Ownership (Third Party)
  agentId String?
  agent   AgentProfile? @relation(fields: [agentId], references: [id])

  // Internal Ownership (UniReach Official)
  assignedStaffId String?
  assignedStaff   StaffProfile? @relation("StaffAssignments", fields: [assignedStaffId], references: [id])

  // --- 1. Personal Information ---
  firstName     String
  lastName      String
  dateOfBirth   DateTime?
  gender        String? // Male, Female, Other
  maritalStatus String? // Single, Married, etc.

  // --- 2. Contact & Address ---
  phone     String?
  email     String? // Alternate email
  addresses ApplicantAddress[]

  // --- 3. Passport & Nationality ---
  passportNo           String?   @unique
  passportIssueDate    DateTime?
  passportExpiryDate   DateTime?
  passportIssueCountry String?
  cityOfBirth          String?
  countryOfBirth       String?

  nationality          String?
  citizenship          String? // Primary Citizenship
  otherCitizenships    String[] // List of other citizenships
  livingInOtherCountry Boolean  @default(false)
  currentCountry       String?
  visaStatus           String?

  // --- 4. Background Information ---
  immigrationApplied Boolean @default(false)
  immigrationDetails String?

  medicalCondition Boolean @default(false)
  medicalDetails   String?

  visaRefusal    Boolean @default(false)
  refusalDetails Json? // { country: "USA", date: "2023", reason: "..." }

  criminalOffence Boolean @default(false)
  criminalDetails String?

  // --- 5. Additional Info ---
  isUSGreenCardHolder Boolean @default(false)
  isCanadianPR        Boolean @default(false)
  gapExplanation      String? // Details about education/work gaps

  // --- 6. Related Records ---
  emergencyContacts  EmergencyContact[]
  educationHistory   EducationHistory[]
  workExperience     WorkExperience[]
  englishProficiency EnglishProficiency[]

  documents              Document[]
  unlockRequests         ProfileUnlockRequest[]
  documentUnlockRequests DocumentUnlockRequest[]

  metadata Json? // Custom/Legacy fields

  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  enquiries    Enquiry[]
  applications Application[]
}

model ApplicantAddress {
  id          String           @id @default(uuid())
  applicantId String
  applicant   ApplicantProfile @relation(fields: [applicantId], references: [id], onDelete: Cascade)

  type     AddressType // MAILING, PERMANENT
  address1 String
  address2 String?
  country  String
  state    String
  city     String
  pincode  String

  createdAt DateTime @default(now())
}

model EmergencyContact {
  id          String           @id @default(uuid())
  applicantId String
  applicant   ApplicantProfile @relation(fields: [applicantId], references: [id], onDelete: Cascade)

  name     String
  phone    String
  email    String?
  relation String // Father, Mother, Spouse, etc.
}

model EducationHistory {
  id          String           @id @default(uuid())
  applicantId String
  applicant   ApplicantProfile @relation(fields: [applicantId], references: [id], onDelete: Cascade)

  level             EducationLevel
  country           String
  state             String
  city              String
  institutionName   String
  boardOrUniversity String // Name of University/Board

  qualification String? // Degree Awarded (e.g. B.Sc, High School Diploma)

  startDate  DateTime
  endDate    DateTime? // If null, currently studying
  isPursuing Boolean   @default(false)

  score         String // CGPA or Percentage
  gradingSystem String // e.g. "4.0 Scale", "Percentage", "Letter"

  primaryLanguage String // Medium of Instruction

  createdAt DateTime @default(now())
}

model WorkExperience {
  id          String           @id @default(uuid())
  applicantId String
  applicant   ApplicantProfile @relation(fields: [applicantId], references: [id], onDelete: Cascade)

  employerName String
  designation  String
  startDate    DateTime
  endDate      DateTime? // If null, currently working
  isCurrent    Boolean   @default(false)

  responsibilities String? // Description of role

  address String? // City/Country of work

  createdAt DateTime @default(now())
}

model EnglishProficiency {
  id          String           @id @default(uuid())
  applicantId String
  applicant   ApplicantProfile @relation(fields: [applicantId], references: [id], onDelete: Cascade)

  testName EnglishTestType // IELTS, TOEFL, PTE, DUOLINGO, GRE
  examDate DateTime

  overallScore Float?
  reading      Float?
  writing      Float?
  listening    Float?
  speaking     Float?

  // For tests like GRE/GMAT that don't fit reading/writing/listening/speaking
  scoreDetails Json? // e.g. { "verbal": 160, "quant": 170, "analytical": 4.5 }

  trfNumber String? // Test Report Form Number or Registration Number

  certificatePending Boolean @default(false) // Yet to Receive Certificate
  hasMOI             Boolean @default(false) // Medium of Instruction available

  createdAt DateTime @default(now())
}

enum EnglishTestType {
  IELTS
  TOEFL
  PTE
  DUOLINGO
  GRE
  GMAT
  OTHER
}

// --- AUDIT & HISTORY ---
model LoginLog {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  ip        String?
  userAgent String?
  metadata  Json?
  createdAt DateTime @default(now())
}

model AuditLog {
  id            String   @id @default(uuid())
  performedById String
  performedBy   User     @relation("PerformedBy", fields: [performedById], references: [id])
  action        String
  entityType    String
  entityId      String
  oldValue      Json?
  newValue      Json?
  createdAt     DateTime @default(now())
}

// --- ENUMS ---
enum AccountStatus {
  ACTIVE
  SUSPENDED
  PENDING_VERIFICATION
  DEACTIVATED
  INACTIVE
}

enum ApplicantType {
  STUDENT
  EXPATRIATE
}

enum RoleCategory {
  SYSTEM
  STAFF
  AGENT
  APPLICANT
}

// --- LEAD MANAGEMENT (Intelligence Layer) ---
model Lead {
  id        String  @id @default(uuid())
  firstName String
  lastName  String?
  email     String  @unique
  phone     String? // WhatsApp or Direct

  // Education Intent
  preferredCountry   String // e.g. "Germany", "Hungary"
  studyLevel         String? // Undergraduate, Postgraduate
  fieldOfStudy       String?
  academicResults    String?
  passingYear        String?
  englishProficiency String?
  message            String? @db.Text

  status         String    @default("New Inquiry")
  source         String?   @default("LANDING_PAGE")
  nextFollowUpAt DateTime?

  // Chain of Custody
  assignedCounselorId String?
  assignedCounselor   StaffProfile? @relation("CounselorLeads", fields: [assignedCounselorId], references: [id])

  // Black Box Recorder
  events LeadEvent[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([email])
  @@index([status])
  @@index([preferredCountry])
  @@index([nextFollowUpAt])
}

model LeadEvent {
  id     String @id @default(uuid())
  leadId String
  lead   Lead   @relation(fields: [leadId], references: [id], onDelete: Cascade)

  type LeadEventType

  // Auditor (Optional for system-generated events)
  performerId String?
  performer   StaffProfile? @relation("EventPerformer", fields: [performerId], references: [id])

  // Context (e.g. { "from": "UK Team", "to": "DE Team", "note": "..." })
  metadata Json?

  createdAt DateTime @default(now())
}

enum LeadEventType {
  CREATE
  ASSIGNMENT
  TRANSFER
  STATUS_CHANGE
  NOTE
  QUALIFICATION
  CONVERSION
}

// --- TEAM MANAGEMENT (Specialized Cells) ---
model Team {
  id           String   @id @default(uuid())
  name         String
  vertical     Vertical
  targetLocale String?  // e.g. "Germany", "AU", or "Global"
  description  String?
  
  // Relations
  members   StaffProfile[]
  managerId String?        // Reference to a StaffProfile ID who is the lead
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum Vertical {
  EDUCATION
  MIGRATION
  SALES
  NETWORKING
  FINANCE
  ADMINISTRATION
  LEGAL
}

// --- GLOBAL CONFIGURATION (Geo-Registry & Academic Hierarchy) ---
model Country {
  id        String  @id @default(uuid())
  name      String  @unique // e.g. "Germany"
  code      String  @unique // e.g. "DE"
  flag      String? // URL or path to flag image
  
  isActive  Boolean @default(true)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ProgramLevel {
  id          String   @id @default(uuid())
  name        String   @unique // e.g. "UG Diploma/ Certificate/ Associate Degree"
  code        String   @unique // e.g. "UG_DIP"
  rank        Int      @default(0) // Tactical ordering for UI
  category    String?  @default("GENERAL") // e.g. "DEGREE", "PATHWAY", "SHORT_TERM"
  isActive    Boolean  @default(true)

  courses     Course[]

  // Audit Layer
  createdById String?
  createdBy   User?    @relation("ProgramLevelCreator", fields: [createdById], references: [id])
  updatedById String?
  updatedBy   User?    @relation("ProgramLevelUpdater", fields: [updatedById], references: [id])

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model StudyArea {
  id          String   @id @default(uuid())
  name        String   @unique // e.g. "Engineering & Technology"
  isActive    Boolean  @default(true)
  
  disciplines Discipline[]
  courses     Course[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Discipline {
  id          String   @id @default(uuid())
  name        String   @unique // e.g. "Computer Science"
  
  studyAreaId String
  studyArea   StudyArea @relation(fields: [studyAreaId], references: [id])
  
  isActive    Boolean  @default(true)
  courses     Course[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// --- INVENTORY (Universities & Courses) ---
model University {
  id          String  @id @default(uuid())
  name        String  @unique
  country     String
  code        String  @unique // e.g. "UNI_OXF"
  description String?
  logo        String?
  website     String?

  courses Course[]
  
  // Partnership Intelligence (Internal Metrics)
  strategicRank      Int      @default(0)    // Internal priority (higher = promoted)
  commissionSpeed    Int      @default(3)    // 1-5 Scale: 1 (Slow) to 5 (Instant)
  offerTATIndex      Int      @default(3)    // 1-5 Scale (Turnaround Time)
  visaSuccessRate    Float    @default(0)    // Percentage (0-100)
  
  // Performance Hooks
  isPremiumPartner   Boolean  @default(false)
  hasDirectContract  Boolean  @default(true)
  
  // Tactical Assets
  bannerImage        String?
  strategicTags      String[] // e.g. ["Research Intensive", "High Employment", "Low Cost of Living"]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Course {
  id           String     @id @default(uuid())
  universityId String
  university   University @relation(fields: [universityId], references: [id], onDelete: Cascade)

  name         String
  code         String? // e.g. "CS_101"
  
  levelId      String
  level        ProgramLevel @relation(fields: [levelId], references: [id])
  
  // Tactical Operational Fields
  duration     String 
  campus       String?
  courseUrl    String?
  intakeMonths String[] 
  
  // Financial Intelligence
  tuitionFee          Float    @default(0) // Yearly Tuition Fee
  applicationFee      Float    @default(0)
  currency            String   @default("USD")
  expectedCommission  String?  // Amount or Percentage
  
  // Deadlines & Availability
  applicationDeadline String?
  isActive            Boolean  @default(true)
  
  // Tactical Intelligence Flags (Admission)
  isFastTrack         Boolean  @default(false) // Faster Offer TAT
  hasScholarship      Boolean  @default(false) // Scholarship Available
  highAcceptanceRate  Boolean  @default(false) // High Offer Acceptance Rate
  isStem              Boolean  @default(false) // STEM Programs
  isInterviewOptional Boolean  @default(false) // No Interview Required
  hasEnglishWaiver    Boolean  @default(false) // English Proficiency Exam Waiver
  
  // Tactical Intelligence Flags (Financial)
  hasAppFeeWaiver     Boolean  @default(false) // Application Fee Waiver
  lowTuitionDeposit   Boolean  @default(false) // Low Tuition Deposit
  hasLoanSupport      Boolean  @default(false) // Eligible Non Collateral Loan
  isAffordable        Boolean  @default(false) // Affordable University
  
  // Tactical Intelligence Flags (Regional & Career)
  isMajorCity         Boolean  @default(false)
  isRegional          Boolean  @default(false) // Regional University
  hasCoop             Boolean  @default(false) // Co-op & Built-in Internships
  highJobDemand       Boolean  @default(false) // High Job Demand
  
  // Academic & Requirement Flags
  hasMathsWaiver      Boolean  @default(false) // Without Maths
  hasGreGmatWaiver    Boolean  @default(false) // Without GRE/GMAT
  requiresWorkExp     Boolean  @default(false) // Work Experience Required
  
  // Strategic Attributes (Dynamic Tags e.g. ["Russel Group", "MBA", "Higher Backlog"])
  strategicFlags      String[]

  // Academic Core
  studyAreaId         String?
  studyArea           StudyArea? @relation(fields: [studyAreaId], references: [id])
  disciplineId        String?
  discipline          Discipline? @relation(fields: [disciplineId], references: [id])
  entryRequirements   String?  @db.Text
  englishRequirements String?  @db.Text
  moiAccepted         Boolean  @default(false)
  standardizedTests   String?  @db.Text
  
  // Additional Intelligence
  remarks             String?  @db.Text
  extraNotes          String?  @db.Text
  additionalRequirements Json?  // Flexible metadata for edge cases

  applications Application[]
  enquiries    Enquiry[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// --- OPERATIONS (Enquiries & Applications) ---
model Enquiry {
  id   String @id @default(uuid())
  code String @unique @default(cuid()) // Reference Number

  // Who is asking?
  applicantId String?
  applicant   ApplicantProfile? @relation(fields: [applicantId], references: [id])

  agentId String?
  agent   AgentProfile? @relation(fields: [agentId], references: [id])

  // About what?
  courseId String?
  course   Course? @relation(fields: [courseId], references: [id])

  subject String
  message String
  status  EnquiryStatus @default(OPEN)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Application {
  id   String @id @default(uuid())
  code String @unique @default(cuid()) // Application Reference ID

  // Who is applying?
  applicantId String
  applicant   ApplicantProfile @relation(fields: [applicantId], references: [id], onDelete: Cascade)

  // To what?
  courseId String
  course   Course @relation(fields: [courseId], references: [id])

  // Processed By (Unireach Staff)
  assignedStaffId String?
  assignedStaff   StaffProfile? @relation(fields: [assignedStaffId], references: [id])

  status ApplicationStatus @default(DRAFT)

  // Timeline/Notes
  notes     ApplicationNote[]
  documents Document[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([applicantId, courseId]) // Prevent duplicate applications to same course
}

model ApplicationNote {
  id            String      @id @default(uuid())
  applicationId String
  application   Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  content    String
  isInternal Boolean @default(true) // If true, only visible to Unireach Staff

  createdBy String // User ID or Name snapshot
  createdAt DateTime @default(now())
}

// --- NOTIFICATION ENGINE (UNE) ---
model Notification {
  id     String @id @default(uuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  type    NotificationType    @default(INFO)
  channel NotificationChannel @default(IN_APP)

  title    String
  message  String @db.Text
  metadata Json? // e.g. { "link": "/applications/123", "action": "View" }

  isRead Boolean   @default(false)
  sentAt DateTime?

  createdAt DateTime @default(now())

  @@index([userId])
  @@index([isRead])
}

model NotificationPreference {
  id     String @id @default(uuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  emailEnabled     Boolean @default(true)
  pushEnabled      Boolean @default(true)
  marketingEnabled Boolean @default(false)

  updatedAt DateTime @updatedAt
}

enum EnquiryStatus {
  OPEN
  IN_PROGRESS
  RESOLVED
  CLOSED
}

enum ApplicationStatus {
  DRAFT
  SUBMITTED_TO_UNIREACH
  UNDER_REVIEW
  SUBMITTED_TO_UNIVERSITY
  OFFER_CONDITIONAL
  OFFER_UNCONDITIONAL
  REJECTED
  VISA_PROCESSING
  ENROLLED
  WITHDRAWN
}

enum NotificationType {
  INFO
  SUCCESS
  WARNING
  ERROR
  SYSTEM
}

enum NotificationChannel {
  IN_APP
  EMAIL
  WHATSAPP
  SMS
  PUSH
}

enum AddressType {
  MAILING
  PERMANENT
}

enum EducationLevel {
  GRADE_10
  GRADE_12
  DIPLOMA
  UNDERGRADUATE
  POSTGRADUATE
  PHD
  OTHER
}

// --- DMS MODELS ---

model Document {
  id          String           @id @default(uuid())
  applicantId String
  applicant   ApplicantProfile @relation(fields: [applicantId], references: [id], onDelete: Cascade)

  applicationId String?
  application   Application? @relation(fields: [applicationId], references: [id])

  name     String // Display name
  category DocumentCategory

  fileKey  String // Storage path (S3/Tebi)
  fileSize Int // Bytes
  mimeType String

  uploadSource UploadSource
  uploaderId   String // User ID who uploaded

  status      DocumentStatus @default(PENDING)
  isAdminOnly Boolean        @default(false)
  isLocked    Boolean        @default(false)

  adminNote String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  unlockRequests DocumentUnlockRequest[]

  @@index([applicantId])
  @@index([category])
  @@index([uploadSource])
}

model ProfileUnlockRequest {
  id          String           @id @default(uuid())
  applicantId String
  applicant   ApplicantProfile @relation(fields: [applicantId], references: [id], onDelete: Cascade)

  reason String
  status RequestStatus @default(PENDING)

  adminNote    String?
  resolvedById String?
  resolvedBy   StaffProfile? @relation(fields: [resolvedById], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([applicantId])
  @@index([status])
}

model DocumentUnlockRequest {
  id          String           @id @default(uuid())
  applicantId String
  applicant   ApplicantProfile @relation(fields: [applicantId], references: [id], onDelete: Cascade)

  documentId String
  document   Document @relation(fields: [documentId], references: [id], onDelete: Cascade)

  reason String
  status RequestStatus @default(PENDING)

  adminNote    String?
  resolvedById String?
  resolvedBy   StaffProfile? @relation(fields: [resolvedById], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([applicantId])
  @@index([documentId])
  @@index([status])
}

enum DocumentCategory {
  // Academic - Mandatory
  STD_10_MARKSHEET
  STD_10_CERTIFICATE
  STD_12_MARKSHEET
  STD_12_CERTIFICATE
  BACHELORS_TRANSCRIPTS
  BACHELORS_CERTIFICATE
  MASTERS_TRANSCRIPTS
  MASTERS_CERTIFICATE

  // Academic - Optional
  CONSOLIDATED_MARKSHEET

  // Identity/Personal
  PASSPORT
  PASSPORT_PHOTO
  CV
  SOP_ESSAY
  LOR

  // Language & Background
  ENGLISH_CERTIFICATE
  MOI_LETTER
  WORK_EXPERIENCE_LETTER

  // Others
  POWER_OF_ATTORNEY
  GRE_GMAT
  OTHER

  // Staff/Official Docs
  OFFER_LETTER
  ADMISSION_CONFIRMATION
  VISA_GUIDANCE
  INVOICE
}

enum UploadSource {
  APPLICANT
  STAFF
  AGENT
}

enum DocumentStatus {
  PENDING
  VERIFIED
  REJECTED
  OFFICIAL
}

enum RequestStatus {
  PENDING
  APPROVED
  REJECTED
}
// --- SUCCESS STORIES (Client Victories) ---
model SuccessStory {
  id          String   @id @default(uuid())
  type        String   @default("image") // image, video
  category    String   @default("student") // student, business, job
  
  name        String
  destination String
  university  String?
  program     String?
  visaType    String?
  year        String
  
  thumbnail   String
  image       String?   // For image type
  videoUrl    String?   // For video type (YouTube/Vimeo embed)
  
  quote       String   @db.Text
  isFeatured  Boolean  @default(false)
  
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([category])
  @@index([isFeatured])
}
